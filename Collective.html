<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Mathematics of Collective Mind</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'serif': ['Crimson Text', 'Georgia', 'serif'],
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        'earth': {
                            50: '#faf8f5',
                            100: '#f4f0e8',
                            200: '#e8ddd0',
                            300: '#d9c7b0',
                            400: '#c7a888',
                            500: '#b8916b',
                            600: '#a67c5a',
                            700: '#8a654b',
                            800: '#715342',
                            900: '#5c4437',
                        },
                        'cosmic': {
                            50: '#f0f4ff',
                            100: '#e0e9ff',
                            200: '#c7d6ff',
                            300: '#a5b8ff',
                            400: '#8191ff',
                            500: '#5d6aff',
                            600: '#4338ca',
                            700: '#3730a3',
                            800: '#312e81',
                            900: '#1e1b4b',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #4338ca, #5d6aff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .motion-blur {
            filter: blur(0.5px);
            transform: translateZ(0);
        }
        .parallax-bg {
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }
        .mermaid-container {
            display: flex;
            justify-content: center;
            min-height: 300px;
            max-height: 800px;
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .mermaid-container .mermaid {
            width: 100%;
            max-width: 100%;
            height: 100%;
            cursor: grab;
            transition: transform 0.3s ease;
            transform-origin: center center;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .mermaid-container .mermaid svg {
            max-width: 100%;
            height: 100%;
            display: block;
            margin: 0 auto;
        }

        .mermaid-container .mermaid:active {
            cursor: grabbing;
        }

        .mermaid-container.zoomed .mermaid {
            height: 100%;
            width: 100%;
            cursor: grab;
        }

        .mermaid-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 20;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .mermaid-control-btn {
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #374151;
            font-size: 14px;
            min-width: 36px;
            height: 36px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mermaid-control-btn:hover {
            background: #f8fafc;
            border-color: #3b82f6;
            color: #3b82f6;
            transform: translateY(-1px);
        }

    .mermaid-control-btn:active {
        transform: scale(0.95);
    }

    @media (max-width: 1024px) {
        .mermaid-control-btn:not(.reset-zoom) {
            display: none;
        }
        .mermaid-controls {
            top: auto;
            bottom: 15px;
            right: 15px;
        }
    }
</style>
  </head>

  <body class="font-sans text-gray-900 bg-gradient-to-br from-earth-50 to-cosmic-50 overflow-x-hidden">

    <!-- Fixed Table of Contents -->
    <nav id="toc" class="fixed left-0 top-0 h-full w-80 bg-white/95 backdrop-blur-sm border-r border-earth-200 z-40 overflow-y-auto transform -translate-x-full lg:translate-x-0 transition-transform duration-300">
      <div class="p-6">
        <h3 class="font-serif font-semibold text-lg text-earth-800 mb-4">Table of Contents</h3>
        <ul class="space-y-2 text-sm">
          <li>
            <a href="#hero" class="block py-2 px-3 text-earth-700 hover:text-cosmic-600 hover:bg-cosmic-50 rounded transition-colors">The Evolutionary Trap</a>
          </li>
          <li>
            <a href="#executive-summary" class="block py-2 px-3 text-earth-700 hover:text-cosmic-600 hover:bg-cosmic-50 rounded transition-colors">Executive Summary</a>
          </li>
          <li>
            <a href="#narrative-analysis" class="block py-2 px-3 text-earth-700 hover:text-cosmic-600 hover:bg-cosmic-50 rounded transition-colors">Narrative Analysis</a>
          </li>
          <li>
            <a href="#mathematical-model" class="block py-2 px-3 text-earth-700 hover:text-cosmic-600 hover:bg-cosmic-50 rounded transition-colors">Mathematical Model</a>
          </li>
          <li>
            <a href="#workability" class="block py-2 px-3 text-earth-700 hover:text-cosmic-600 hover:bg-cosmic-50 rounded transition-colors">Workability & Validity</a>
          </li>
          <li>
            <a href="#comparative" class="block py-2 px-3 text-earth-700 hover:text-cosmic-600 hover:bg-cosmic-50 rounded transition-colors">Comparative Analysis</a>
          </li>
          <li>
            <a href="#critical-evaluation" class="block py-2 px-3 text-earth-700 hover:text-cosmic-600 hover:bg-cosmic-50 rounded transition-colors">Critical Evaluation</a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Mobile TOC Toggle -->
    <button id="toc-toggle" class="fixed top-4 left-4 z-50 lg:hidden bg-white/90 backdrop-blur-sm p-3 rounded-full shadow-lg border border-earth-200">
      <i class="fas fa-bars text-earth-700"></i>
    </button>

    <!-- Overlay for closing TOC -->
    <div id="toc-overlay" class="fixed inset-0 z-40 bg-black/50 hidden lg:hidden"></div>

    <!-- Main Content -->
    <main class="ml-0 lg:ml-80 min-h-screen">

      <!-- Hero Section -->
      <section id="hero" class="relative min-h-screen flex items-center justify-center overflow-hidden bg-gradient-to-br from-earth-100 via-cosmic-50 to-earth-50">
        <div class="absolute inset-0 opacity-10">
          <img src="https://kimi-img.moonshot.cn/pub/icon/spinner.svg" alt="Cosmic neural network in deep space" class="w-full h-full object-cover parallax-bg motion-blur" size="wallpaper" aspect="wide" color="blue" style="photo" query="cosmic neural network" referrerpolicy="no-referrer" />
        </div>

        <div class="relative z-10 max-w-6xl mx-auto px-4 sm:px-8 py-16">
          <!-- Bento Grid Layout -->
          <div class="grid grid-cols-1 md:grid-cols-12 gap-6 h-full">
            <!-- Main Title -->
            <div class="md:col-span-8 flex flex-col justify-center">
              <h1 class="font-serif text-3xl sm:text-4xl md:text-5xl lg:text-7xl font-bold leading-tight mb-6">
                <span class="gradient-text italic">The Mathematics</span>
                <br>
                <span class="text-earth-800">of Collective Mind</span>
              </h1>
              <p class="text-base sm:text-lg md:text-xl text-earth-600 font-light leading-relaxed max-w-2xl">
                An analysis of a proposed framework for overcoming humanity's evolutionary trap through the assembly of collective agency
              </p>
            </div>

            <!-- Visual Element -->
            <div class="md:col-span-4 flex items-center justify-center">
              <div class="relative w-32 h-32 sm:w-48 sm:h-48 md:w-64 md:h-64">
                <div class="absolute inset-0 bg-cosmic-600 rounded-full opacity-20 animate-pulse"></div>
                <div class="absolute inset-4 bg-cosmic-500 rounded-full opacity-30"></div>
                <div class="absolute inset-8 bg-white rounded-full flex items-center justify-center">
                  <i class="fas fa-network-wired text-3xl sm:text-4xl text-cosmic-600"></i>
                </div>
              </div>
            </div>

            <!-- Key Highlights Grid -->
            <div class="md:col-span-12 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mt-8">
              <div class="bg-white/80 backdrop-blur-sm p-6 rounded-lg border border-earth-200">
                <h3 class="font-serif text-lg font-semibold text-earth-800 mb-2">Evolutionary Trap</h3>
                <p class="text-sm text-earth-600">The chasm between individual and collective agency</p>
              </div>
              <div class="bg-white/80 backdrop-blur-sm p-6 rounded-lg border border-earth-200">
                <h3 class="font-serif text-lg font-semibold text-earth-800 mb-2">Mathematical Framework</h3>
                <p class="text-sm text-earth-600">Hypergraphs and multi-objective optimization</p>
              </div>
              <div class="bg-white/80 backdrop-blur-sm p-6 rounded-lg border border-earth-200">
                <h3 class="font-serif text-lg font-semibold text-earth-800 mb-2">Collective Agency</h3>
                <p class="text-sm text-earth-600">Transforming individuals into synergistic wholes</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Executive Summary -->
      <section id="executive-summary" class="py-16 bg-white">
        <div class="max-w-4xl mx-auto px-8">
          <h2 class="font-serif text-4xl font-bold text-earth-800 mb-8">Executive Summary</h2>

          <div class="prose prose-lg max-w-none">
            <p class="text-xl text-earth-700 leading-relaxed mb-8 font-light">
              Humanity faces an unprecedented challenge: our powerful individual intellect has created global problems that our underdeveloped collective agency cannot solve. This evolutionary trap threatens our ability to navigate the emergence of artificial intelligence and address existential risks like climate change.
            </p>

            <div class="grid md:grid-cols-2 gap-8 my-12">
              <div class="bg-earth-50 p-8 rounded-lg">
                <h3 class="font-serif text-xl font-semibold text-earth-800 mb-4">The Problem</h3>
                <ul class="space-y-2 text-earth-700">
                  <li>• Paleolithic brains vs. Anthropocene challenges</li>
                  <li>• Individual brilliance creates collective problems</li>
                  <li>• Weak global cooperation mechanisms</li>
                  <li>• AI emergence amplifies uncertainty</li>
                </ul>
              </div>

              <div class="bg-cosmic-50 p-8 rounded-lg">
                <h3 class="font-serif text-xl font-semibold text-cosmic-800 mb-4">The Solution</h3>
                <ul class="space-y-2 text-cosmic-700">
                  <li>• Mathematical platform for collective agency</li>
                  <li>• Hypergraph modeling of social structures</li>
                  <li>• Multi-objective optimization for team assembly</li>
                  <li>• Human-AI collaborative intelligence</li>
                </ul>
              </div>
            </div>

            <blockquote class="border-l-4 border-cosmic-500 pl-6 my-8 italic text-lg text-earth-700">
              "The proposed framework suggests that humanity's primary challenge can be overcome by creating a new social institution—a mathematical platform designed to assemble human and artificial intelligence into synergistic collectives."
            </blockquote>
          </div>
        </div>
      </section>

      <!-- Narrative Analysis -->
      <section id="narrative-analysis" class="py-16 bg-gradient-to-r from-earth-50 to-cosmic-50">
        <div class="max-w-6xl mx-auto px-8">
          <h2 class="font-serif text-4xl font-bold text-earth-800 mb-12">Narrative Analysis: The Evolutionary Trap</h2>

          <div class="grid lg:grid-cols-3 gap-8 mb-12">
            <div class="lg:col-span-2">
              <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-6">The Central Metaphor</h3>
              <p class="text-earth-700 leading-relaxed mb-6">
                The concept of an "evolutionary trap" serves as the narrative's foundation, borrowed from biology where it describes behaviors that become maladaptive in changed environments. <a href="https://www.sciencedaily.com/releases/2023/11/231113111803.htm" class="text-cosmic-600 hover:underline" target="_blank">Research from the Stockholm Resilience Centre</a> has identified 14 such traps threatening humanity, including short-termism and biosphere disconnect.
              </p>

              <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200 mb-6">
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">The Trap Mechanism</h4>
                <p class="text-earth-700 text-sm leading-relaxed">
                  Our brains evolved for individual survival—recognizing threats, competing for resources, maximizing personal benefit. This was adaptive in our ancestral past but creates a mismatch with modern civilization's collective challenges.
                </p>
              </div>
            </div>

            <div class="space-y-6">
              <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">The Two Paradoxes</h4>
                <div class="space-y-3 text-sm text-earth-700">
                  <div>
                    <strong>Dark Forest Theory:</strong> Universe as dangerous place where revealing existence risks annihilation
                  </div>
                  <div>
                    <strong>Sagan's Optimism:</strong> Advanced civilizations naturally seek cooperation
                  </div>
                </div>
              </div>

              <div class="bg-cosmic-100 p-6 rounded-lg">
                <h4 class="font-serif text-lg font-semibold text-cosmic-800 mb-3">The Third Way</h4>
                <p class="text-cosmic-700 text-sm leading-relaxed">
                  Radical otherness—intelligence so different that our categories of "friend" and "enemy" become meaningless. Their goals might be incomprehensible to us.
                </p>
              </div>
            </div>
          </div>

          <!-- Evolutionary Flow Diagram -->
          <div class="bg-white p-8 rounded-lg shadow-sm border border-earth-200 mb-12">
            <h3 class="font-serif text-xl font-semibold text-earth-800 mb-6 text-center">From Individual to Collective Intelligence</h3>
            <div class="mermaid-container">
              <div class="mermaid-controls">
                <button class="mermaid-control-btn zoom-in" title="Zoom In">
                  <i class="fas fa-search-plus"></i>
                </button>
                <button class="mermaid-control-btn zoom-out" title="Zoom Out">
                  <i class="fas fa-search-minus"></i>
                </button>
                <button class="mermaid-control-btn reset-zoom" title="Reset">
                  <i class="fas fa-expand-arrows-alt"></i>
                </button>
                <button class="mermaid-control-btn fullscreen" title="Fullscreen">
                  <i class="fas fa-expand"></i>
                </button>
              </div>
              <div class="mermaid">
                graph TD
                A["Individual Agency
                <br />Evolved for Survival"] --> B["Paleolithic Brain"]
                B --> C["Competition & Tribalism"]
                C --> D["Global Civilization"]
                D --> E["Anthropocene Problems"]
                E --> F["Evolutionary Trap"]
                F --> G["Mathematical Platform"]
                G --> H["Collective Agency"]
                H --> I["Synergistic Intelligence"]

                style A fill:#f4f0e8,stroke:#8a654b,stroke-width:2px,color:#2d2d2d
                style B fill:#f4f0e8,stroke:#8a654b,stroke-width:2px,color:#2d2d2d
                style C fill:#f4f0e8,stroke:#8a654b,stroke-width:2px,color:#2d2d2d
                style D fill:#f4f0e8,stroke:#8a654b,stroke-width:2px,color:#2d2d2d
                style E fill:#f4f0e8,stroke:#8a654b,stroke-width:2px,color:#2d2d2d
                style F fill:#fee2e2,stroke:#dc2626,stroke-width:3px,color:#2d2d2d
                style G fill:#dbeafe,stroke:#4338ca,stroke-width:3px,color:#2d2d2d
                style H fill:#c7d6ff,stroke:#4338ca,stroke-width:3px,color:#2d2d2d
                style I fill:#a5b8ff,stroke:#4338ca,stroke-width:3px,color:#2d2d2d
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Mathematical Model -->
      <section id="mathematical-model" class="py-16 bg-white">
        <div class="max-w-6xl mx-auto px-8">
          <h2 class="font-serif text-4xl font-bold text-earth-800 mb-12">Mathematical Model of Collective Synergy</h2>

          <!-- Role Representation -->
          <div class="mb-12">
            <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-8">Role Representation: Modeling the Individual</h3>

            <div class="bg-cosmic-50 p-8 rounded-lg mb-8">
              <h4 class="font-serif text-xl font-semibold text-cosmic-800 mb-4">The Role Tuple</h4>
              <div class="text-center text-2xl font-mono bg-white p-6 rounded border-2 border-cosmic-200">
                r<sub>i</sub> = (S<sub>i</sub>, D<sub>i</sub>, M̃<sub>i</sub>, C<sub>i</sub>)
              </div>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
              <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                <h5 class="font-serif text-lg font-semibold text-earth-800 mb-3">S<sub>i</sub> - Skills</h5>
                <p class="text-sm text-earth-700">Vector representing competencies, interests, and cognitive style in ℝ<sup>k</sup> space</p>
              </div>
              <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                <h5 class="font-serif text-lg font-semibold text-earth-800 mb-3">D<sub>i</sub> - Deficits</h5>
                <p class="text-sm text-earth-700">Vector representing lack of competence, experience, or cognitive styles</p>
              </div>
              <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                <h5 class="font-serif text-lg font-semibold text-earth-800 mb-3">M̃<sub>i</sub> - Motivation</h5>
                <p class="text-sm text-earth-700">Non-linear, probabilistic representation of motivational structure</p>
              </div>
              <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                <h5 class="font-serif text-lg font-semibold text-earth-800 mb-3">C<sub>i</sub> - Capacity</h5>
                <p class="text-sm text-earth-700">Measure of adaptability and dynamic role-taking ability</p>
              </div>
            </div>
          </div>

          <!-- Hypergraph Model -->
          <div class="mb-12">
            <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-8">Social Structure: The Hypergraph Model</h3>

            <div class="grid lg:grid-cols-3 gap-8">
              <div class="lg:col-span-2">
                <p class="text-earth-700 leading-relaxed mb-6">
                  The collective is modeled as a hypergraph G = (V, E), where vertices V represent roles and hyperedges E represent multi-way interactions. This generalizes traditional graphs by allowing edges to connect any number of vertices, capturing the complexity of real-world team dynamics.
                </p>

                <div class="bg-earth-50 p-6 rounded-lg mb-6">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Topological Complexity Features</h4>
                  <ul class="space-y-2 text-sm text-earth-700">
                    <li>• <strong>Multi-granularity:</strong> Different sized hyperedges for varied group interactions</li>
                    <li>• <strong>Uneven connections:</strong> Hub formation and power-law distributions</li>
                    <li>• <strong>Hierarchy representation:</strong> Directed hyperedges for authority structures</li>
                    <li>• <strong>Temporal dynamics:</strong> Time slices {G<sub>t</sub>} for evolving networks</li>
                  </ul>
                </div>
              </div>

              <div class="bg-cosmic-50 p-6 rounded-lg">
                <h4 class="font-serif text-lg font-semibold text-cosmic-800 mb-4">Hypergraph Advantages</h4>
                <div class="space-y-3 text-sm text-cosmic-700">
                  <div class="flex items-start space-x-2">
                    <i class="fas fa-check-circle text-cosmic-600 mt-1"></i>
                    <span>Natural representation of group meetings</span>
                  </div>
                  <div class="flex items-start space-x-2">
                    <i class="fas fa-check-circle text-cosmic-600 mt-1"></i>
                    <span>Captures higher-order interactions</span>
                  </div>
                  <div class="flex items-start space-x-2">
                    <i class="fas fa-check-circle text-cosmic-600 mt-1"></i>
                    <span>Models nested, overlapping groups</span>
                  </div>
                  <div class="flex items-start space-x-2">
                    <i class="fas fa-check-circle text-cosmic-600 mt-1"></i>
                    <span>Represents complex dependencies</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Optimization Function -->
          <div class="mb-12">
            <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-8">The Optimization Engine</h3>

            <div class="bg-cosmic-50 p-8 rounded-lg mb-8">
              <h4 class="font-serif text-xl font-semibold text-cosmic-800 mb-4">Energy Function</h4>
              <div class="text-center text-xl font-mono bg-white p-6 rounded border-2 border-cosmic-200 overflow-x-auto">
                E(G) = λ₁·Diversity(G) + λ₂·Synergy(G) - λ₃·Conflict<sub>multi</sub>(G) - λ₄·CentralityBias<sub>scale</sub>(G)
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
              <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                  <h5 class="font-serif text-lg font-semibold text-earth-800 mb-3">Diversity(G)</h5>
                  <p class="text-sm text-earth-700 mb-3">Extended entropy of skills considering multi-dimensional distributions</p>
                  <div class="text-xs text-earth-600 bg-earth-50 p-3 rounded">
                    <strong>Goal:</strong> Maximize cognitive and skill variety for creative problem-solving
                  </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                  <h5 class="font-serif text-lg font-semibold text-earth-800 mb-3">Synergy(G)</h5>
                  <p class="text-sm text-earth-700 mb-3">Weighted average of motivational synergy across multi-dimensional representations</p>
                  <div class="text-xs text-earth-600 bg-earth-50 p-3 rounded">
                    <strong>Goal:</strong> Maximize positive interactions and complementary motivations
                  </div>
                </div>
              </div>

              <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                  <h5 class="font-serif text-lg font-semibold text-earth-800 mb-3">Conflict<sub>multi</sub>(G)</h5>
                  <p class="text-sm text-earth-700 mb-3">Complex metric including multi-dimensional emotional and cognitive conflicts</p>
                  <div class="text-xs text-earth-600 bg-earth-50 p-3 rounded">
                    <strong>Goal:</strong> Minimize friction and counterproductive interactions
                  </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                  <h5 class="font-serif text-lg font-semibold text-earth-800 mb-3">CentralityBias<sub>scale</sub>(G)</h5>
                  <p class="text-sm text-earth-700 mb-3">Scalable metric accounting for power-law degree distributions</p>
                  <div class="text-xs text-earth-600 bg-earth-50 p-3 rounded">
                    <strong>Goal:</strong> Minimize over-reliance on key individuals for resilience
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Platform Architecture -->
          <div class="bg-gradient-to-r from-earth-50 to-cosmic-50 p-8 rounded-lg">
            <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-8 text-center">Platform Architecture: From Individuals to Collective Intelligence</h3>

            <div class="grid md:grid-cols-4 gap-6">
              <div class="text-center">
                <div class="bg-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm">
                  <i class="fas fa-user-brain text-2xl text-cosmic-600"></i>
                </div>
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-2">Deep Profiling</h4>
                <p class="text-sm text-earth-700">AI-driven interviews reveal Meta-Roles beyond surface skills</p>
              </div>

              <div class="text-center">
                <div class="bg-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm">
                  <i class="fas fa-project-diagram text-2xl text-cosmic-600"></i>
                </div>
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-2">Project Decomposition</h4>
                <p class="text-sm text-earth-700">AI-assisted breakdown into required roles and vectors</p>
              </div>

              <div class="text-center">
                <div class="bg-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm">
                  <i class="fas fa-puzzle-piece text-2xl text-cosmic-600"></i>
                </div>
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-2">Assembly</h4>
                <p class="text-sm text-earth-700">Optimization finds complementary Meta-Roles for synergy</p>
              </div>

              <div class="text-center">
                <div class="bg-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm">
                  <i class="fas fa-chart-line text-2xl text-cosmic-600"></i>
                </div>
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-2">Evolution</h4>
                <p class="text-sm text-earth-700">Dynamic profiles grow through successful collaboration</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Workability & Validity -->
      <section id="workability" class="py-16 bg-gradient-to-br from-earth-50 to-cosmic-50">
        <div class="max-w-6xl mx-auto px-8">
          <h2 class="font-serif text-4xl font-bold text-earth-800 mb-12">Workability & Validity Assessment</h2>

          <div class="grid lg:grid-cols-2 gap-12">
            <!-- Workability -->
            <div>
              <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-8">Workability: Implementation Feasibility</h3>

              <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3 flex items-center">
                    <i class="fas fa-microchip text-cosmic-600 mr-3"></i>
                    Technological Readiness
                  </h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Convergence of AI profiling, graph theory, and optimization algorithms provides strong foundation. Recent advances in natural language processing and network science support implementation feasibility.
                  </p>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3 flex items-center">
                    <i class="fas fa-cogs text-cosmic-600 mr-3"></i>
                    Algorithmic Complexity
                  </h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Team optimization is NP-hard, but heuristic approaches like genetic algorithms and simulated annealing can provide practical solutions. Parallel processing enables scalability.
                  </p>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border border-earth-200">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3 flex items-center">
                    <i class="fas fa-database text-cosmic-600 mr-3"></i>
                    Data Requirements
                  </h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Requires comprehensive profiling data. Challenge lies in developing robust, ethical data collection systems that respect privacy while capturing nuanced human attributes.
                  </p>
                </div>
              </div>
            </div>

            <!-- Validity -->
            <div>
              <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-8">Validity: Scientific Grounding</h3>

              <div class="space-y-6">
                <div class="bg-cosmic-50 p-6 rounded-lg border border-cosmic-200">
                  <h4 class="font-serif text-lg font-semibold text-cosmic-800 mb-3 flex items-center">
                    <i class="fas fa-atom text-cosmic-600 mr-3"></i>
                    Scientific Discourse
                  </h4>
                  <p class="text-cosmic-700 text-sm leading-relaxed">
                    "Evolutionary trap" concept aligns with established research in ecology and social sciences. <a href="https://www.sciencedaily.com/releases/2023/11/231113111803.htm" class="underline" target="_blank">Stockholm Resilience Centre's work</a> provides empirical foundation.
                  </p>
                </div>

                <div class="bg-cosmic-50 p-6 rounded-lg border border-cosmic-200">
                  <h4 class="font-serif text-lg font-semibold text-cosmic-800 mb-3 flex items-center">
                    <i class="fas fa-calculator text-cosmic-600 mr-3"></i>
                    Mathematical Precedents
                  </h4>
                  <p class="text-cosmic-700 text-sm leading-relaxed">
                    Hypergraphs and multi-objective optimization are well-established fields. Model builds on proven mathematical frameworks with existing literature and applications.
                  </p>
                </div>

                <div class="bg-cosmic-50 p-6 rounded-lg border border-cosmic-200">
                  <h4 class="font-serif text-lg font-semibold text-cosmic-800 mb-3 flex items-center">
                    <i class="fas fa-flask text-cosmic-600 mr-3"></i>
                    Empirical Validation
                  </h4>
                  <p class="text-cosmic-700 text-sm leading-relaxed">
                    Key challenge is developing reliable measures for synergy, diversity, and conflict. Requires extensive experimental validation and field studies.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Validation Framework -->
          <div class="mt-12 bg-white p-8 rounded-lg shadow-sm border border-earth-200">
            <h3 class="font-serif text-xl font-semibold text-earth-800 mb-6 text-center">Validation Framework</h3>
            <div class="mermaid-container">
              <div class="mermaid-controls">
                <button class="mermaid-control-btn zoom-in" title="Zoom In">
                  <i class="fas fa-search-plus"></i>
                </button>
                <button class="mermaid-control-btn zoom-out" title="Zoom Out">
                  <i class="fas fa-search-minus"></i>
                </button>
                <button class="mermaid-control-btn reset-zoom" title="Reset">
                  <i class="fas fa-expand-arrows-alt"></i>
                </button>
                <button class="mermaid-control-btn fullscreen" title="Fullscreen">
                  <i class="fas fa-expand"></i>
                </button>
              </div>
              <div class="mermaid">
                graph LR
                A["Conceptual Model"] --> B["Mathematical Formulation"]
                B --> C["Simulation Testing"]
                C --> D["Laboratory Experiments"]
                D --> E["Field Studies"]
                E --> F["Real-world Deployment"]
                F --> G["Continuous Validation"]

                B --> H["Algorithm Efficiency"]
                C --> I["Predictive Accuracy"]
                D --> J["Construct Validity"]
                E --> K["Ecological Validity"]

                style A fill:#f4f0e8,stroke:#8a654b,stroke-width:2px,color:#2d2d2d
                style B fill:#dbeafe,stroke:#4338ca,stroke-width:2px,color:#2d2d2d
                style C fill:#dbeafe,stroke:#4338ca,stroke-width:2px,color:#2d2d2d
                style D fill:#dbeafe,stroke:#4338ca,stroke-width:2px,color:#2d2d2d
                style E fill:#dbeafe,stroke:#4338ca,stroke-width:2px,color:#2d2d2d
                style F fill:#dbeafe,stroke:#4338ca,stroke-width:2px,color:#2d2d2d
                style G fill:#a5b8ff,stroke:#4338ca,stroke-width:3px,color:#2d2d2d
                style H fill:#fee2e2,stroke:#dc2626,stroke-width:2px,color:#2d2d2d
                style I fill:#fee2e2,stroke:#dc2626,stroke-width:2px,color:#2d2d2d
                style J fill:#fee2e2,stroke:#dc2626,stroke-width:2px,color:#2d2d2d
                style K fill:#fee2e2,stroke:#dc2626,stroke-width:2px,color:#2d2d2d
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Comparative Analysis -->
      <section id="comparative" class="py-16 bg-white">
        <div class="max-w-6xl mx-auto px-8">
          <h2 class="font-serif text-4xl font-bold text-earth-800 mb-12">Comparative Analysis</h2>

          <div class="grid lg:grid-cols-3 gap-8 mb-12">
            <div class="lg:col-span-2">
              <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-6">Alternative Mathematical Frameworks</h3>

              <div class="space-y-6">
                <div class="bg-earth-50 p-6 rounded-lg">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Active Inference Models</h4>
                  <p class="text-earth-700 text-sm leading-relaxed mb-3">
                    Based on minimizing "free energy" between predictions and sensory input. Focuses on dynamic adaptation rather than structural composition.
                  </p>
                  <div class="text-xs text-earth-600">
                    <strong>Difference:</strong> Proposed framework emphasizes team formation over individual behavior dynamics
                  </div>
                </div>

                <div class="bg-earth-50 p-6 rounded-lg">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Entropy-Based Models</h4>
                  <p class="text-earth-700 text-sm leading-relaxed mb-3">
                    Measures team diversity through information entropy. Effective for quantifying complexity but limited to single dimension.
                  </p>
                  <div class="text-xs text-earth-600">
                    <strong>Advancement:</strong> Multi-objective optimization balances diversity with synergy and conflict minimization
                  </div>
                </div>

                <div class="bg-earth-50 p-6 rounded-lg">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Game-Theoretic Approaches</h4>
                  <p class="text-earth-700 text-sm leading-relaxed mb-3">
                    Analyzes strategic interactions and cooperation dilemmas. Often relies on rationality assumptions that may not hold for human behavior.
                  </p>
                  <div class="text-xs text-earth-600">
                    <strong>Innovation:</strong> Less reliance on rationality assumptions, more focus on structural optimization
                  </div>
                </div>
              </div>
            </div>

            <div>
              <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-6">Existing Platforms</h3>

              <div class="space-y-4">
                <div class="bg-cosmic-50 p-4 rounded-lg border border-cosmic-200">
                  <h4 class="font-serif text-base font-semibold text-cosmic-800 mb-2">Team Composition Tools</h4>
                  <p class="text-cosmic-700 text-sm">Most use psychometric testing and simple matching algorithms</p>
                </div>

                <div class="bg-cosmic-50 p-4 rounded-lg border border-cosmic-200">
                  <h4 class="font-serif text-base font-semibold text-cosmic-800 mb-2">Professional Networks</h4>
                  <p class="text-cosmic-700 text-sm">Focus on connections and endorsements, not collective optimization</p>
                </div>

                <div class="bg-cosmic-50 p-4 rounded-lg border border-cosmic-200">
                  <h4 class="font-serif text-base font-semibold text-cosmic-800 mb-2">AI Collaboration Tools</h4>
                  <p class="text-cosmic-700 text-sm">Emphasize interaction dynamics over structural composition</p>
                </div>
              </div>

              <div class="mt-8 bg-gradient-to-br from-cosmic-100 to-cosmic-50 p-6 rounded-lg">
                <h4 class="font-serif text-lg font-semibold text-cosmic-800 mb-4">Key Innovations</h4>
                <ul class="space-y-2 text-sm text-cosmic-700">
                  <li>• Hypergraph + role embeddings integration</li>
                  <li>• Human-AI collective agency focus</li>
                  <li>• Multi-objective optimization engine</li>
                  <li>• Global problem-solving application</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Feature Comparison Table -->
          <div class="bg-white border border-earth-200 rounded-lg overflow-hidden">
            <h3 class="font-serif text-xl font-semibold text-earth-800 p-6 bg-earth-50">Platform Feature Comparison</h3>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-earth-100">
                  <tr>
                    <th class="text-left p-4 font-serif text-earth-800">Feature</th>
                    <th class="text-center p-4 font-serif text-earth-800">Traditional Tools</th>
                    <th class="text-center p-4 font-serif text-earth-800">AI-Enhanced Platforms</th>
                    <th class="text-center p-4 font-serif text-cosmic-800 bg-cosmic-50">Proposed Framework</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-earth-200">
                  <tr>
                    <td class="p-4 text-sm font-medium text-earth-800">Individual Representation</td>
                    <td class="p-4 text-center text-sm text-earth-700">Skills list</td>
                    <td class="p-4 text-center text-sm text-earth-700">Psychometric profiles</td>
                    <td class="p-4 text-center text-sm text-cosmic-700 bg-cosmic-50 font-medium">Multi-dimensional role tuples</td>
                  </tr>
                  <tr class="bg-earth-25">
                    <td class="p-4 text-sm font-medium text-earth-800">Social Modeling</td>
                    <td class="p-4 text-center text-sm text-earth-700">Simple connections</td>
                    <td class="p-4 text-center text-sm text-earth-700">Basic graph theory</td>
                    <td class="p-4 text-center text-sm text-cosmic-700 bg-cosmic-50 font-medium">Dynamic hypergraphs</td>
                  </tr>
                  <tr>
                    <td class="p-4 text-sm font-medium text-earth-800">Optimization</td>
                    <td class="p-4 text-center text-sm text-earth-700">Keyword matching</td>
                    <td class="p-4 text-center text-sm text-earth-700">Simple algorithms</td>
                    <td class="p-4 text-center text-sm text-cosmic-700 bg-cosmic-50 font-medium">Multi-objective energy function</td>
                  </tr>
                  <tr class="bg-earth-25">
                    <td class="p-4 text-sm font-medium text-earth-800">Human-AI Integration</td>
                    <td class="p-4 text-center text-sm text-earth-700">None</td>
                    <td class="p-4 text-center text-sm text-earth-700">Limited</td>
                    <td class="p-4 text-center text-sm text-cosmic-700 bg-cosmic-50 font-medium">Core design principle</td>
                  </tr>
                  <tr>
                    <td class="p-4 text-sm font-medium text-earth-800">Temporal Dynamics</td>
                    <td class="p-4 text-center text-sm text-earth-700">Static</td>
                    <td class="p-4 text-center text-sm text-earth-700">Limited updates</td>
                    <td class="p-4 text-center text-sm text-cosmic-700 bg-cosmic-50 font-medium">Time slices with evolution</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Critical Evaluation -->
      <section id="critical-evaluation" class="py-16 bg-gradient-to-br from-earth-50 to-cosmic-50">
        <div class="max-w-6xl mx-auto px-8">
          <h2 class="font-serif text-4xl font-bold text-earth-800 mb-12">Critical Evaluation & Future Directions</h2>

          <div class="grid lg:grid-cols-2 gap-12 mb-12">
            <!-- Strengths -->
            <div>
              <h3 class="font-serif text-2xl font-semibold text-cosmic-800 mb-8 flex items-center">
                <i class="fas fa-star text-cosmic-600 mr-3"></i>
                Strengths
              </h3>

              <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-cosmic-500">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Formal Approach to Complex Problem</h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Transforms qualitative collective action challenges into quantitative, tractable mathematical formulations. Provides principled framework for optimization.
                  </p>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-cosmic-500">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Enhanced Human Collaboration</h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Potential to create more effective, synergistic teams capable of tackling previously intractable problems while making collaboration more meaningful for individuals.
                  </p>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-cosmic-500">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Proactive AI Future Stance</h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Offers empowering vision for human-AI collaboration rather than passive acceptance of AI dominance. Focuses on collective agency as defense mechanism.
                  </p>
                </div>
              </div>
            </div>

            <!-- Limitations -->
            <div>
              <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-8 flex items-center">
                <i class="fas fa-exclamation-triangle text-earth-600 mr-3"></i>
                Limitations & Challenges
              </h3>

              <div class="space-y-6">
                <div class="bg-earth-50 p-6 rounded-lg border-l-4 border-earth-500">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Human Motivation Complexity</h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Modeling motivation as non-linear, probabilistic structures is ambitious but may oversimplify complex, contradictory human drives. Measurement validity remains challenging.
                  </p>
                </div>

                <div class="bg-earth-50 p-6 rounded-lg border-l-4 border-earth-500">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Over-Engineering Risk</h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Optimization focus might create efficient but sterile teams, overlooking importance of informal relationships, serendipity, and human chemistry essential for innovation.
                  </p>
                </div>

                <div class="bg-earth-50 p-6 rounded-lg border-l-4 border-earth-500">
                  <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Ethical Considerations</h4>
                  <p class="text-earth-700 text-sm leading-relaxed">
                    Sensitive individual data collection raises privacy concerns. Platform could be misused for agenda-driven team optimization rather than collective benefit.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Future Research -->
          <div class="bg-white p-8 rounded-lg shadow-sm border border-earth-200">
            <h3 class="font-serif text-2xl font-semibold text-earth-800 mb-8 text-center">Future Research & Development Pathway</h3>

            <div class="grid md:grid-cols-3 gap-8">
              <div class="text-center">
                <div class="bg-cosmic-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-flask text-3xl text-cosmic-600"></i>
                </div>
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Proof-of-Concept</h4>
                <p class="text-sm text-earth-700 leading-relaxed">
                  Develop small-scale prototypes for controlled team assembly tasks. Validate optimization algorithms and gather performance data.
                </p>
              </div>

              <div class="text-center">
                <div class="bg-cosmic-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-calculator text-3xl text-cosmic-600"></i>
                </div>
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Model Refinement</h4>
                <p class="text-sm text-earth-700 leading-relaxed">
                  Enhance motivation modeling, conflict prediction, and synergy measurement. Integrate machine learning for adaptive optimization.
                </p>
              </div>

              <div class="text-center">
                <div class="bg-cosmic-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-globe text-3xl text-cosmic-600"></i>
                </div>
                <h4 class="font-serif text-lg font-semibold text-earth-800 mb-3">Real-World Applications</h4>
                <p class="text-sm text-earth-700 leading-relaxed">
                  Partner with organizations across sectors to identify high-impact applications. Develop ethical frameworks and deployment strategies.
                </p>
              </div>
            </div>
          </div>

          <!-- Final Reflection -->
          <div class="mt-12 bg-gradient-to-r from-cosmic-100 to-earth-100 p-8 rounded-lg">
            <blockquote class="text-center">
              <p class="font-serif text-xl italic text-earth-800 leading-relaxed mb-4">
                "The proposed framework offers a bold vision for transforming humanity from competing individuals into a harmonious choir of meta-roles, capable of solving our most pressing challenges and navigating an uncertain future alongside artificial intelligence."
              </p>
              <footer class="text-earth-600 font-medium">
                — The Mathematics of Collective Mind
              </footer>
            </blockquote>
          </div>
        </div>
      </section>
    </main>

    <!-- Scripts -->
    <script>
        // Initialize Mermaid with enhanced styling
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#f4f0e8',
                primaryTextColor: '#2d2d2d',
                primaryBorderColor: '#8a654b',
                lineColor: '#4338ca',
                secondaryColor: '#dbeafe',
                tertiaryColor: '#c7d6ff',
                background: '#ffffff',
                mainBkg: '#f4f0e8',
                secondBkg: '#dbeafe',
                tertiaryBkg: '#c7d6ff',
                // Enhanced contrast colors
                nodeBorder: '#8a654b',
                clusterBkg: '#faf8f5',
                edgeLabelBackground: '#ffffff',
                nodeTextColor: '#2d2d2d'
            },
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 20,
                nodeSpacing: 50,
                rankSpacing: 80
            },
            fontFamily: 'Inter, system-ui, sans-serif',
            fontSize: 14
        });

        // Initialize Mermaid Controls for zoom and pan
        function initializeMermaidControls() {
            const containers = document.querySelectorAll('.mermaid-container');

            containers.forEach(container => {
            const mermaidElement = container.querySelector('.mermaid');
            let scale = 1;
            let isDragging = false;
            let startX, startY, translateX = 0, translateY = 0;

            // 触摸相关状态
            let isTouch = false;
            let touchStartTime = 0;
            let initialDistance = 0;
            let initialScale = 1;
            let isPinching = false;

            // Zoom controls
            const zoomInBtn = container.querySelector('.zoom-in');
            const zoomOutBtn = container.querySelector('.zoom-out');
            const resetBtn = container.querySelector('.reset-zoom');
            const fullscreenBtn = container.querySelector('.fullscreen');

            function updateTransform() {
                mermaidElement.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;

                if (scale > 1) {
                container.classList.add('zoomed');
                } else {
                container.classList.remove('zoomed');
                }

                mermaidElement.style.cursor = isDragging ? 'grabbing' : 'grab';
            }

            if (zoomInBtn) {
                zoomInBtn.addEventListener('click', () => {
                scale = Math.min(scale * 1.25, 4);
                updateTransform();
                });
            }

            if (zoomOutBtn) {
                zoomOutBtn.addEventListener('click', () => {
                scale = Math.max(scale / 1.25, 0.3);
                if (scale <= 1) {
                    translateX = 0;
                    translateY = 0;
                }
                updateTransform();
                });
            }

            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                scale = 1;
                translateX = 0;
                translateY = 0;
                updateTransform();
                });
            }

            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', () => {
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                } else if (container.webkitRequestFullscreen) {
                    container.webkitRequestFullscreen();
                } else if (container.msRequestFullscreen) {
                    container.msRequestFullscreen();
                }
                });
            }

            // Mouse Events
            mermaidElement.addEventListener('mousedown', (e) => {
                if (isTouch) return; // 如果是触摸设备，忽略鼠标事件

                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                mermaidElement.style.cursor = 'grabbing';
                updateTransform();
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging && !isTouch) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateTransform();
                }
            });

            document.addEventListener('mouseup', () => {
                if (isDragging && !isTouch) {
                isDragging = false;
                mermaidElement.style.cursor = 'grab';
                updateTransform();
                }
            });

            document.addEventListener('mouseleave', () => {
                if (isDragging && !isTouch) {
                isDragging = false;
                mermaidElement.style.cursor = 'grab';
                updateTransform();
                }
            });

            // 获取两点之间的距离
            function getTouchDistance(touch1, touch2) {
                return Math.hypot(
                touch2.clientX - touch1.clientX,
                touch2.clientY - touch1.clientY
                );
            }

            // Touch Events - 触摸事件处理
            mermaidElement.addEventListener('touchstart', (e) => {
                isTouch = true;
                touchStartTime = Date.now();

                if (e.touches.length === 1) {
                // 单指拖动
                isPinching = false;
                isDragging = true;

                const touch = e.touches[0];
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;

                } else if (e.touches.length === 2) {
                // 双指缩放
                isPinching = true;
                isDragging = false;

                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                initialDistance = getTouchDistance(touch1, touch2);
                initialScale = scale;
                }

                e.preventDefault();
            }, { passive: false });

            mermaidElement.addEventListener('touchmove', (e) => {
                if (e.touches.length === 1 && isDragging && !isPinching) {
                // 单指拖动
                const touch = e.touches[0];
                translateX = touch.clientX - startX;
                translateY = touch.clientY - startY;
                updateTransform();

                } else if (e.touches.length === 2 && isPinching) {
                // 双指缩放
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDistance = getTouchDistance(touch1, touch2);

                if (initialDistance > 0) {
                    const newScale = Math.min(Math.max(
                    initialScale * (currentDistance / initialDistance),
                    0.3
                    ), 4);
                    scale = newScale;
                    updateTransform();
                }
                }

                e.preventDefault();
            }, { passive: false });

            mermaidElement.addEventListener('touchend', (e) => {
                // 重置状态
                if (e.touches.length === 0) {
                isDragging = false;
                isPinching = false;
                initialDistance = 0;

                // 延迟重置isTouch，避免鼠标事件立即触发
                setTimeout(() => {
                    isTouch = false;
                }, 100);
                } else if (e.touches.length === 1 && isPinching) {
                // 从双指变为单指，切换为拖动模式
                isPinching = false;
                isDragging = true;

                const touch = e.touches[0];
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;
                }

                updateTransform();
            });

            mermaidElement.addEventListener('touchcancel', (e) => {
                isDragging = false;
                isPinching = false;
                initialDistance = 0;

                setTimeout(() => {
                isTouch = false;
                }, 100);

                updateTransform();
            });

            // Enhanced wheel zoom with better center point handling
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                const rect = container.getBoundingClientRect();
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                const newScale = Math.min(Math.max(scale * delta, 0.3), 4);

                // Adjust translation to zoom towards center
                if (newScale !== scale) {
                const scaleDiff = newScale / scale;
                translateX = translateX * scaleDiff;
                translateY = translateY * scaleDiff;
                scale = newScale;

                if (scale <= 1) {
                    translateX = 0;
                    translateY = 0;
                }

                updateTransform();
                }
            });

            // Initialize display
            updateTransform();
            });
        }

        // TOC Toggle
        const toc = document.getElementById('toc');
        const tocToggle = document.getElementById('toc-toggle');
        const tocOverlay = document.getElementById('toc-overlay');

        function toggleTOC() {
            toc.classList.toggle('-translate-x-full');
            tocOverlay.classList.toggle('hidden');
        }

        function closeTOC() {
            toc.classList.add('-translate-x-full');
            tocOverlay.classList.add('hidden');
        }

        tocToggle.addEventListener('click', toggleTOC);
        tocOverlay.addEventListener('click', closeTOC);

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    // Close TOC on mobile after clicking
                    if (window.innerWidth < 1024) {
                        closeTOC();
                    }
                }
            });
        });

        // Close TOC when window is resized to desktop
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1024) {
                closeTOC();
            }
        });

        // Initialize Mermaid controls after page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for mermaid to render first
            setTimeout(() => {
                initializeMermaidControls();
            }, 2000);
        });
    </script>
  </body>

</html>